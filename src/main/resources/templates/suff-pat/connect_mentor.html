<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
    th:replace="suff-pat_base :: parent(~{::section}, 'Connect Mentor', ~{::script})">

<head>
    <title>Connect Mentor - Suffering Patient</title>
</head>

<body>
    <section class="container mx-auto px-4 py-6">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
            <div>
                <h1 class="text-2xl sm:text-3xl font-extrabold text-gray-900">Find and connect with Mentors</h1>
                <p class="text-sm text-gray-600 mt-1">Search, filter and request a connection with a health mentor.</p>
            </div>

            <div class="mt-4 sm:mt-0 flex items-center space-x-3">
                <input id="mentor-search" type="search" placeholder="Search by name or expertise"
                    class="px-3 py-2 border rounded-lg w-60 sm:w-80 focus:outline-none focus:ring-2 focus:ring-blue-500" />

                                <select id="expertise-filter" class="px-3 py-2 border rounded-lg bg-white">
                    <option value="">All Expertise Areas</option>
                    <option th:each="m : ${mentors}" th:value="${m.areaOfExpertise}" th:text="${m.areaOfExpertise}"></option>
                </select>
            </div>
        </div>

        <div th:if="${not #lists.isEmpty(mentors)}" class="space-y-4">
            <div th:each="mentor : ${mentors}"
                class="mentor-card w-full p-4 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-sm hover:shadow-lg transform hover:-translate-y-1 transition">
                <div class="flex flex-col sm:flex-row sm:items-center w-full gap-4">
                    <!-- Profile / avatar -->
                    <div class="flex items-center sm:items-start w-full sm:w-1/6">
                        <div
                            class="w-24 h-24 rounded-md overflow-hidden flex items-center justify-center text-3xl text-gray-700 dark:text-gray-200 border-2 border-blue-100 dark:border-blue-900">
                            <img th:if="${mentor.profilePicture != null}" th:src="${mentor.profilePicture}"
                                alt="Profile" class="w-full h-full object-cover" />
                            <span th:if="${mentor.profilePicture == null}"
                                th:text="${mentor.name != null ? mentor.name.substring(0,1) : 'M'}"></span>
                        </div>
                    </div>

                    <!-- Main details -->
                    <div class="flex-1 w-full sm:w-3/5">
                        <div class="flex items-start justify-between">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900 dark:text-gray-100 flex items-center gap-3">
                                    <span th:text="${mentor.name}">Mentor Name</span>
                                    <span class="text-xs text-gray-500 font-medium" th:if="${mentor.areaOfExpertise}"
                                        th:text="${mentor.areaOfExpertise}"></span>
                                </h3>

                                <!-- rating -->
                                <div class="mt-2 flex items-center gap-2">
                                    <div class="flex items-center text-yellow-400">
                                        <span th:each="i : ${#numbers.sequence(1,5)}" class="mr-0.5"
                                            th:classappend="${(mentor.mentorPerformance != null and mentor.mentorPerformance.mentorshipRating >= i) ? 'text-yellow-400' : 'text-gray-300'}">&#9733;</span>
                                    </div>
                                    <div class="text-sm text-gray-600"
                                        th:text="${mentor.mentorPerformance != null ? mentor.mentorPerformance.mentorshipRating : 0}">
                                        0.0</div>
                                    <div class="text-xs text-gray-400 ml-2" th:if="${mentor.mentorPerformance != null}">
                                        (<span th:text="${mentor.mentorPerformance.menteesHelped}">0</span> mentees)
                                    </div>
                                </div>

                                <p class="mt-3 text-sm text-gray-700 dark:text-gray-300" th:if="${mentor.about != null}"
                                    th:text="${#strings.abbreviate(mentor.about, 350)}"></p>

                                <div class="mt-3 flex flex-wrap gap-2">
                                    <span
                                        class="inline-block text-xs px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded"
                                        th:if="${mentor.certifications}" th:text="${mentor.certifications}"></span>
                                    <span class="inline-block text-xs px-2 py-1 bg-green-100 text-green-800 rounded"
                                        th:if="${mentor.mentorshipExperience != null}">Exp: <span
                                            th:text="${mentor.mentorshipExperience}">0</span> yrs</span>
                                </div>
                            </div>

                            <!-- availability pill -->
                            <div class="text-right">
                                <div class="inline-block px-3 py-1 bg-green-50 text-green-800 text-xs rounded">Available
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Actions / contact -->
                    <div class="w-full sm:w-1/6 flex flex-col sm:items-end justify-between">
                        <div class="flex flex-col sm:items-end gap-2">
                            <div class="flex gap-2">
                                <a th:href="@{'/suff-pat/connect_mentor/request/' + ${mentor.mentorId}}"
                                    class="inline-block px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Connect</a>
                                <a th:href="@{'/mentor/profile?mentorId=' + ${mentor.mentorId}}"
                                    class="inline-block px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">View
                                    profile</a>
                            </div>

                            <div class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                <div th:if="${mentor.phoneNumber != null}" class="flex items-center gap-2"><svg
                                        class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M3 5a2 2 0 0 1 2-2h3.28a2 2 0 0 1 1.91 1.37l.7 2.1a2 2 0 0 1-.45 2.09L8.7 11.7a11.05 11.05 0 0 0 5.6 5.6l2.1-1.74a2 2 0 0 1 2.09-.45l2.1.7A2 2 0 0 1 21 17.72V21a2 2 0 0 1-2 2H19c-9.39 0-17-7.61-17-17V5z">
                                        </path>
                                    </svg><span th:text="${mentor.phoneNumber}"></span></div>
                                <div th:if="${mentor.email != null}" class="flex items-center gap-2 mt-1"><svg
                                        class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M3 8l7.89 5.26a2 2 0 0 0 2.22 0L21 8"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M21 8v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8"></path>
                                    </svg><span th:text="${mentor.email}"></span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div th:if="${#lists.isEmpty(mentors)}" class="p-6 bg-yellow-50 rounded-lg">
            <p class="text-gray-700">No mentors available at the moment. Please check back later.</p>
        </div>

        <!-- success toast when requested param present -->
        <div th:if="${param.requested}" id="connect-toast"
            class="fixed bottom-6 right-6 bg-green-600 text-white px-4 py-2 rounded shadow-lg flex items-center space-x-3">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            <div>
                <div class="font-semibold">Request sent</div>
                <div class="text-sm">Your connection request was sent to the mentor.</div>
            </div>
        </div>

        <script>
            (function () {
                const searchInput = document.getElementById('mentor-search');
                const expFilter = document.getElementById('expertise-filter');

                function normalize(s) { return (s || '').toString().toLowerCase(); }

                function filterCards() {
                    const q = normalize(searchInput.value);
                    const exp = normalize(expFilter.value);
                    document.querySelectorAll('.mentor-card').forEach(card => {
                        const h3 = card.querySelector('h3');
                        const nameSpan = h3?.querySelector('span:first-child');
                        const expSpan = h3?.querySelector('span.text-xs.text-gray-500');
                        const aboutP = card.querySelector('p');
                        const name = normalize(nameSpan?.textContent || '');
                        const expertise = normalize(expSpan?.textContent || '');
                        const about = normalize(aboutP?.textContent || '');
                        const matchesQuery = !q || name.includes(q) || expertise.includes(q) || about.includes(q);
                        const matchesExp = !exp || expertise.includes(exp);
                        card.style.display = (matchesQuery && matchesExp) ? '' : 'none';
                    })
                }

                if (searchInput) searchInput.addEventListener('input', filterCards);
                if (expFilter) expFilter.addEventListener('change', filterCards);

                // auto-hide toast after 4s
                const toast = document.getElementById('connect-toast');
                if (toast) { setTimeout(() => { toast.style.display = 'none'; }, 4000); }
            })();
        </script>
    </section>
</body>

</html>